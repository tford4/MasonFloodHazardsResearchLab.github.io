/*! UA-Web-Push: 325a2d9482:1490139724508 */
(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["uaSetup"]=factory();else root["uaSetup"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=25)}([function(module,exports){var config={configured:false,workerUrl:"/push-worker.js",apiUrl:"https://web-push-api.urbanairship.com",storagePrefix:"_ua_sdk",appKey:null,secret:null,token:null,vapidPublicKey:null,debug:false,paths:{cla:"/api/channels",cra:"/api/web-channels",tags:"/api/web-channels/tags/",reports:{direct:"/api/web-events/direct",session:"/api/web-events/session"}}};try{config.secureHost="https://"+window.location.host;config.insecureHost="http://"+window.location.host}catch(e){}module.exports=config},function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var config=__webpack_require__(0);var debug=__webpack_require__(3);var global=void 0;try{global=window}catch(e){global=self}module.exports=function request(path,options){path=""+config.apiUrl+path;var headers={Accept:"application/vnd.urbanairship+json; version=3;"};if(config.appKey&&config.token){headers["X-UA-Appkey"]=config.appKey;headers["Authorization"]="Bearer "+config.token}else if(config.appKey&&config.secret){var authstr=global.btoa(config.appKey+":"+config.secret);headers["Authorization"]="Basic "+authstr}options.credentials="include";if(options.body){headers["Content-type"]="application/json";if(typeof options.body!=="string"){options.body=JSON.stringify(options.body)}}options.headers=options.headers||{};_extends(options.headers,headers);debug("REQUEST",path,options);return global.fetch(path,options)}},function(module,exports,__webpack_require__){var config=__webpack_require__(0);module.exports={set:function(key,value){return window.localStorage.setItem(keyName(key),value)},get:function(key){return window.localStorage.getItem(keyName(key))},setJSON:function(key,value){return this.set(key,JSON.stringify(value))},getJSON:function(key){return JSON.parse(this.get(key))},remove:function(key){return window.localStorage.getItem(keyName(key))}};function keyName(key){return config.storagePrefix+":"+key}},function(module,exports,__webpack_require__){var config=__webpack_require__(0);module.exports=function debug(){if(config.debug){var _console;(_console=console).log.apply(_console,arguments)}}},function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var config=__webpack_require__(0);var global=void 0;try{global=window}catch(e){global=self}module.exports=function configure(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(config.configured){return config}delete opts.paths;_extends(config,opts);config.storagePrefix=global.btoa(config.storagePrefix+":"+config.appKey+":"+config.workerUrl);config.configured=true;return config}},function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var bowser=__webpack_require__(20);var packageJson=__webpack_require__(24);var SUPPORTED_BROWSERS=["chrome","edge","firefox","opera","safari"];module.exports=function getRegistrationBase(){var windowOpts={};try{var localeOptions=window.Intl.DateTimeFormat().resolvedOptions();var timezone=localeOptions.timeZone;var _localeOptions$locale=localeOptions.locale.split("-"),_localeOptions$locale2=_slicedToArray(_localeOptions$locale,2),locale_language=_localeOptions$locale2[0],locale_country=_localeOptions$locale2[1];windowOpts={timezone:timezone,locale_country:locale_country,locale_language:locale_language}}catch(e){}var user_agent_string=navigator.userAgent;var browser_name=getBrowserName(bowser.name);var browser_version=browser_name+"-"+Number(bowser.version);var browser_type=bowser.mobile||bowser.tablet?"mobile":"desktop";var web_sdk_version=packageJson.version;return _extends(windowOpts,{device_type:"web",opt_in:true,web:{user_agent_string:user_agent_string,browser_name:browser_name,browser_version:browser_version,browser_type:browser_type,web_sdk_version:web_sdk_version}})};function getBrowserName(name){name=name.toLowerCase();if(!SUPPORTED_BROWSERS.includes(name)){return"unknown"}return name}},function(module,exports,__webpack_require__){"use strict";var Commons=__webpack_require__(7);var CustomEventTarget=__webpack_require__(21);var EventWrapper=__webpack_require__(22);var LISTENERS=Commons.LISTENERS;var CAPTURE=Commons.CAPTURE;var BUBBLE=Commons.BUBBLE;var ATTRIBUTE=Commons.ATTRIBUTE;var newNode=Commons.newNode;var defineCustomEventTarget=CustomEventTarget.defineCustomEventTarget;var createEventWrapper=EventWrapper.createEventWrapper;var STOP_IMMEDIATE_PROPAGATION_FLAG=EventWrapper.STOP_IMMEDIATE_PROPAGATION_FLAG;var HAS_EVENTTARGET_INTERFACE=typeof window!=="undefined"&&typeof window.EventTarget!=="undefined";var EventTarget=module.exports=function EventTarget(){if(this instanceof EventTarget){Object.defineProperty(this,LISTENERS,{value:Object.create(null)})}else if(arguments.length===1&&Array.isArray(arguments[0])){return defineCustomEventTarget(EventTarget,arguments[0])}else if(arguments.length>0){var types=Array(arguments.length);for(var i=0;i<arguments.length;++i){types[i]=arguments[i]}return defineCustomEventTarget(EventTarget,types)}else{throw new TypeError("Cannot call a class as a function")}};EventTarget.prototype=Object.create((HAS_EVENTTARGET_INTERFACE?window.EventTarget:Object).prototype,{constructor:{value:EventTarget,writable:true,configurable:true},addEventListener:{value:function addEventListener(type,listener,capture){if(listener==null){return false}if(typeof listener!=="function"&&typeof listener!=="object"){throw new TypeError('"listener" is not an object.')}var kind=capture?CAPTURE:BUBBLE;var node=this[LISTENERS][type];if(node==null){this[LISTENERS][type]=newNode(listener,kind);return true}var prev=null;while(node!=null){if(node.listener===listener&&node.kind===kind){return false}prev=node;node=node.next}prev.next=newNode(listener,kind);return true},configurable:true,writable:true},removeEventListener:{value:function removeEventListener(type,listener,capture){if(listener==null){return false}var kind=capture?CAPTURE:BUBBLE;var prev=null;var node=this[LISTENERS][type];while(node!=null){if(node.listener===listener&&node.kind===kind){if(prev==null){this[LISTENERS][type]=node.next}else{prev.next=node.next}return true}prev=node;node=node.next}return false},configurable:true,writable:true},dispatchEvent:{value:function dispatchEvent(event){var node=this[LISTENERS][event.type];if(node==null){return true}var wrapped=createEventWrapper(event,this);while(node!=null){if(typeof node.listener==="function"){node.listener.call(this,wrapped)}else if(node.kind!==ATTRIBUTE&&typeof node.listener.handleEvent==="function"){node.listener.handleEvent(wrapped)}if(wrapped[STOP_IMMEDIATE_PROPAGATION_FLAG]){break}node=node.next}return!wrapped.defaultPrevented},configurable:true,writable:true}})},function(module,exports,__webpack_require__){"use strict";var createUniqueKey=exports.createUniqueKey=typeof Symbol!=="undefined"?Symbol:function createUniqueKey(name){return"[["+name+"_"+Math.random().toFixed(8).slice(2)+"]]"};exports.LISTENERS=createUniqueKey("listeners");exports.CAPTURE=1;exports.BUBBLE=2;exports.ATTRIBUTE=3;exports.newNode=function newNode(listener,kind){return{listener:listener,kind:kind,next:null}}},function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EventTarget=__webpack_require__(6);var config=__webpack_require__(0);var debug=__webpack_require__(3);var storage=__webpack_require__(2);var request=__webpack_require__(1);var registrationBase=__webpack_require__(5);var Tags=__webpack_require__(18);var Channel=function(_EventTarget){_inherits(Channel,_EventTarget);function Channel(channelData){_classCallCheck(this,Channel);var _this=_possibleConstructorReturn(this,(Channel.__proto__||Object.getPrototypeOf(Channel)).call(this));_this.channel_id=channelData.channel_id;_this.opt_in=channelData.hasOwnProperty("opt_in")?channelData.opt_in:"true";_this.named_user_id=channelData.named_user_id;return _this}_createClass(Channel,[{key:"optOut",value:function optOut(){this.opt_in=false;this._store();return this._update(false).then(function(reponse){return Promise.resolve(true)})}},{key:"toJSON",value:function toJSON(){return _extends(registrationBase(),{channel_id:this.id,opt_in:this.optedIn})}},{key:"_store",value:function _store(){storage.setJSON("channel",{channel_id:this.id,opt_in:this.optedIn});this.dispatchEvent({type:"channel",channel:this})}},{key:"_update",value:function _update(){var omitOptIn=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var channel=this.toJSON();if(omitOptIn){delete channel.opt_in}return request(this.path,{method:"put",body:{channel:channel}})}},{key:"id",get:function(){return this.channel_id}},{key:"optedIn",get:function(){try{return JSON.parse(this.opt_in)}catch(e){return true}}},{key:"path",get:function(){return config.paths.cra+"/"+this.id}},{key:"tags",get:function(){if(!this._tags){this._tags=new Tags(this.channel_id)}return this._tags}}]);return Channel}(EventTarget("channel"));module.exports=Channel},function(module,exports,__webpack_require__){var getBase=__webpack_require__(5);module.exports=function getRegistrationData(subscription){var channel=arguments.length>1&&arguments[1]!==undefined?arguments[1]:getBase();channel.push_address=subscription.endpoint;channel.web.subscription=subscription.toJSON().keys;return{channel:channel}}},function(module,exports,__webpack_require__){var config=__webpack_require__(0);var urlBase64ToUint8Array=__webpack_require__(19);module.exports=function getSubscriptions(registration){return registration.pushManager.getSubscription().then(function(subscription){if(subscription){return subscription}return registration.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:urlBase64ToUint8Array(config.vapidPublicKey)})})}},function(module,exports,__webpack_require__){var config=__webpack_require__(0);var request=__webpack_require__(1);module.exports={direct:direct,session:session};function direct(channel,send_id){var path=config.paths.reports.direct;var body={channel:channel.toJSON(),send_id:send_id};return request(path,{method:"post",body:body})}function session(channel){var path=config.paths.reports.session;var body={channel:channel.toJSON()};return request(path,{method:"post",body:body})}},function(module,exports,__webpack_require__){var config=__webpack_require__(0);var global=void 0;try{global=window}catch(e){global=self}module.exports={getDB:getDB,getObjectStore:getObjectStore,requestToPromise:requestToPromise,get:get,set:set,remove:remove};var DB=void 0;function getDB(){if(DB){return DB}DB=new Promise(function(resolve,reject){var request=global.indexedDB.open(config.storagePrefix+":db",1);request.addEventListener("upgradeneeded",function(ev){var db=ev.target.result;db.createObjectStore("blob",{keyPath:"type"})});request.addEventListener("success",function(ev){return resolve(request.result)});request.addEventListener("error",function(ev){return reject(ev)})});return DB}function getObjectStore(){var writable=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var readwrite=writable?"readwrite":"readonly";return getDB().then(function(db){return db.transaction(["blob"],readwrite).objectStore("blob")})}function requestToPromise(request){var success=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(ev){return ev.target.result};var error=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(ev){return ev.target.error};return new Promise(function(resolve,reject){request.addEventListener("success",function(ev){return resolve(success(ev))});request.addEventListener("error",function(ev){return reject(error(ev))})})}function get(key){return getObjectStore().then(function(os){return requestToPromise(os.get(key),function(ev){return ev.target.result.value})})}function set(key,value){return getObjectStore(true).then(function(os){return requestToPromise(os.put({type:key,value:value}))})}function remove(key,value){return getObjectStore(true).then(function(os){return requestToPromise(os.delete(key))})}},function(module,exports){module.exports=function isSupported(){return!!(navigator.serviceWorker&&window.PushManager)}},function(module,exports,__webpack_require__){var config=__webpack_require__(0);var configure=__webpack_require__(4);var storage=__webpack_require__(2);module.exports={setupBridge:setupBridge,setupIframe:setupIframe,onStorage:onStorage};function onStorage(ready){return function onStorage(ev){var _arr=["tags","channel"];for(var _i=0;_i<_arr.length;_i++){var type=_arr[_i];var key=config.storagePrefix+":"+type;if(ev.key===key){var data={};data[type]=JSON.parse(ev.newValue);ready(data)}}}}function setupBridge(opts){if(window.location.protocol!=="https:"){throw new Error("The secure bridge must be run on an HTTPS domain that "+"is shared the push registration page.")}configure(opts);var target=config.insecureHost;var channel=storage.getJSON("channel");var tags=storage.getJSON("tags");var permission=window.Notification.permission;post({channel:channel,tags:tags,permission:permission});window.addEventListener("storage",onStorage(post));window.addEventListener("message",onMessage);function onMessage(ev){var data=getMessageDataFrom(ev,config.insecureHost);if(data.tags){storage.setJSON("tags",data.tags)}if(data.channel){storage.setJSON("channel",data.channel)}}function post(objs){window.parent.postMessage(prefixObject(objs),target)}}function setupIframe(url){var target=config.secureHost;var sdk=this;var el=document.createElement("iframe");el.style.display="none";el.src=url;document.body.appendChild(el);window.addEventListener("message",onMessage);sdk.addEventListener("tags",function(ev){el.contentWindow.postMessage(prefixObject({tags:ev.tags}),target)});sdk.addEventListener("channel",function(ev){var channel=storage.getJSON("channel");el.contentWindow.postMessage(prefixObject({channel:channel}),target)});function onMessage(ev){var data=getMessageDataFrom(ev,config.secureHost);sdk._set(data)}}function getMessageDataFrom(ev,host){var data=ev.data[config.storagePrefix];if(ev.origin!==host||!data){return}return data}function prefixObject(obj){var data={};data[config.storagePrefix]=obj;return data}},function(module,exports,__webpack_require__){var isSupported=__webpack_require__(13);module.exports=function canRegister(){return!!(isSupported()&&window.isSecureContext&&Notification.permission!=="denied")}},function(module,exports,__webpack_require__){var storage=__webpack_require__(2);module.exports=isAfter;function isAfter(key,hours){key="last_"+key;var HOUR=1e3*60*60;var now=+new Date;var lastActivity=storage.getJSON(key);var store=function(){return storage.setJSON(key,now)};var after=!lastActivity||now-lastActivity>HOUR*hours;return{store:store,after:after}}},function(module,exports,__webpack_require__){var Channel=__webpack_require__(8);var config=__webpack_require__(0);var configure=__webpack_require__(4);var db=__webpack_require__(12);var registrationData=__webpack_require__(9);var reports=__webpack_require__(11);var request=__webpack_require__(1);var subscribe=__webpack_require__(10);module.exports=setupWorker;function setupWorker(self){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};configure(opts);self.addEventListener("push",function(ev){var payload=ev.data?ev.data.json():null;sendToClients(payload);var title=payload.title||config.defaultTitle;if(!payload||!payload.body){return}ev.waitUntil(self.registration.showNotification(title,{body:payload.body,icon:payload.icon||config.defaultIcon,image:payload.image,data:payload,requireInteraction:false}))});self.addEventListener("notificationclick",function(ev){ev.notification.close();var data=ev.notification.data;var action=data.action||{};var link=action["^u"]||action["^d_a"]||action["^p_a"]||config.defaultActionURL;var channel_id=data.channel_id;ev.waitUntil(handleTags(channel_id,data.action));ev.waitUntil(reports.direct(new Channel({channel_id:channel_id}),data.send_id));if(link&&self.clients.openWindow){ev.waitUntil(self.clients.openWindow(link))}});self.addEventListener("pushsubscriptionchange",function(ev){subscribe(self.registration).then(function(subscription){db.get("channel").then(function(channel){if(!channel||!channel.channel_id){return}var registration=registrationData(subscription);var path=config.paths.cra+"/"+channel.channel_id;request(path,{method:"put",body:registration})})})});function sendToClients(payload){var msg={type:"push",push:payload};self.clients.matchAll().then(function(clients){clients.forEach(function(client){return client.postMessage(msg)})})}function handleTags(channel_id){var action=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var add=arrayify(action["^+t"]);var remove=arrayify(action["^-t"]);var body={audience:{channel:channel_id}};if(!add&&!remove){return Promise.resolve(true)}if(add){body.add={device:add}}if(remove){body.remove={device:remove}}return request(config.paths.tags,{method:"post",body:body}).then(function(response){return response.ok});function arrayify(value){if(typeof value==="string"){return[value]}return value}}}},function(module,exports,__webpack_require__){var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EventTarget=__webpack_require__(6);var config=__webpack_require__(0);var debug=__webpack_require__(3);var request=__webpack_require__(1);var storage=__webpack_require__(2);var Tags=function(_EventTarget){_inherits(Tags,_EventTarget);function Tags(channel_id){_classCallCheck(this,Tags);var _this=_possibleConstructorReturn(this,(Tags.__proto__||Object.getPrototypeOf(Tags)).call(this));_this.channel_id=channel_id;_this._load();return _this}_createClass(Tags,[{key:"has",value:function has(tag){var group=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"device";var group_tags=this.tagMap.get(group);return group_tags&&group_tags.has(tag)}},{key:"add",value:function add(tag){var _this2=this;var group=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"device";return new Promise(function(resolve,reject){if(_this2.has(tag,group)){return resolve(true)}if(!_this2.tagMap.has(group)){_this2.tagMap.set(group,new Set([tag]))}else{_this2.tagMap.get(group).add(tag)}return resolve(_this2._send("add",[tag],group))})}},{key:"remove",value:function remove(tag){var _this3=this;var group=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"device";return new Promise(function(resolve,reject){if(!_this3.has(tag,group)){return resolve(true)}if(_this3.tagMap.has(group)){_this3.tagMap.get(group).delete(tag)}return resolve(_this3._send("remove",[tag],group))})}},{key:"set",value:function set(newTags){var group=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"device";this.tagMap.set(group,new Set(newTags));return this._send("set",newTags,group)}},{key:"_load",value:function _load(){var storedTags=arguments.length>0&&arguments[0]!==undefined?arguments[0]:storage.getJSON("tags");var tags=new Map;try{if(storedTags){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.keys(storedTags)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var group=_step.value;tags.set(group,new Set(storedTags[group]))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}catch(err){debug("Error loading tags:",err)}this.tagMap=tags;return this.tagMap}},{key:"_fetch",value:function _fetch(){var _this4=this;return request(config.paths.cla+"/"+this.channel_id,{method:"get"}).then(function(response){return response.json()}).then(function(body){debug("Tags from server");if(body.channel.tags){_this4.tagMap.set("device",new Set(body.channel.tags))}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=Object.keys(body.channel.tag_groups)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var group=_step2.value;_this4.tagMap.set(group,new Set(body.channel.tag_groups[group]))}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}_this4._store();return _this4.tagMap})}},{key:"_send",value:function _send(verb,tags,group){var body={audience:{channel:this.channel_id}};body[verb]={};body[verb][group]=tags;this._store();return request(config.paths.tags,{method:"post",body:body}).then(function(response){return response.ok})}},{key:"_store",value:function _store(){var newTags=this.list;if(newTags!==this._tagList){storage.setJSON("tags",newTags);this._tagList=newTags;this.dispatchEvent({type:"tags",tags:newTags})}}},{key:"list",get:function(){var tagObj={};var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.tagMap[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _ref=_step3.value;var _ref2=_slicedToArray(_ref,2);var group=_ref2[0];var tags=_ref2[1];if(tags.size){tagObj[group]=Array.from(tags)}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return tagObj}}]);return Tags}(EventTarget("tags"));module.exports=Tags},function(module,exports){var global=void 0;try{global=window}catch(e){global=self}module.exports=function urlBase64ToUint8Array(base64String){var padding="=".repeat((4-base64String.length%4)%4);var base64=(base64String+padding).replace(/\-/g,"+").replace(/_/g,"/");var rawData=global.atob(base64);var outputArray=new Uint8Array(rawData.length);for(var i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i)}return outputArray}},function(module,exports,__webpack_require__){!function(root,name,definition){if(typeof module!="undefined"&&module.exports)module.exports=definition();else if(true)__webpack_require__(23)(name,definition);else root[name]=definition()}(this,"bowser",function(){var t=true;function detect(ua){function getFirstMatch(regex){var match=ua.match(regex);return match&&match.length>1&&match[1]||""}function getSecondMatch(regex){var match=ua.match(regex);return match&&match.length>1&&match[2]||""}var iosdevice=getFirstMatch(/(ipod|iphone|ipad)/i).toLowerCase(),likeAndroid=/like android/i.test(ua),android=!likeAndroid&&/android/i.test(ua),nexusMobile=/nexus\s*[0-6]\s*/i.test(ua),nexusTablet=!nexusMobile&&/nexus\s*[0-9]+/i.test(ua),chromeos=/CrOS/.test(ua),silk=/silk/i.test(ua),sailfish=/sailfish/i.test(ua),tizen=/tizen/i.test(ua),webos=/(web|hpw)os/i.test(ua),windowsphone=/windows phone/i.test(ua),samsungBrowser=/SamsungBrowser/i.test(ua),windows=!windowsphone&&/windows/i.test(ua),mac=!iosdevice&&!silk&&/macintosh/i.test(ua),linux=!android&&!sailfish&&!tizen&&!webos&&/linux/i.test(ua),edgeVersion=getFirstMatch(/edge\/(\d+(\.\d+)?)/i),versionIdentifier=getFirstMatch(/version\/(\d+(\.\d+)?)/i),tablet=/tablet/i.test(ua),mobile=!tablet&&/[^-]mobi/i.test(ua),xbox=/xbox/i.test(ua),result;if(/opera/i.test(ua)){result={name:"Opera",opera:t,version:versionIdentifier||getFirstMatch(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}}else if(/opr|opios/i.test(ua)){result={name:"Opera",opera:t,version:getFirstMatch(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||versionIdentifier}}else if(/SamsungBrowser/i.test(ua)){result={name:"Samsung Internet for Android",samsungBrowser:t,version:versionIdentifier||getFirstMatch(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}}else if(/coast/i.test(ua)){result={name:"Opera Coast",coast:t,version:versionIdentifier||getFirstMatch(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}}else if(/yabrowser/i.test(ua)){result={name:"Yandex Browser",yandexbrowser:t,version:versionIdentifier||getFirstMatch(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}}else if(/ucbrowser/i.test(ua)){result={name:"UC Browser",ucbrowser:t,version:getFirstMatch(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/mxios/i.test(ua)){result={name:"Maxthon",maxthon:t,version:getFirstMatch(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/epiphany/i.test(ua)){result={name:"Epiphany",epiphany:t,version:getFirstMatch(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/puffin/i.test(ua)){result={name:"Puffin",puffin:t,version:getFirstMatch(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}}else if(/sleipnir/i.test(ua)){result={name:"Sleipnir",sleipnir:t,version:getFirstMatch(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}}else if(/k-meleon/i.test(ua)){result={name:"K-Meleon",kMeleon:t,version:getFirstMatch(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}}else if(windowsphone){result={name:"Windows Phone",windowsphone:t};if(edgeVersion){result.msedge=t;result.version=edgeVersion}else{result.msie=t;result.version=getFirstMatch(/iemobile\/(\d+(\.\d+)?)/i)}}else if(/msie|trident/i.test(ua)){result={name:"Internet Explorer",msie:t,version:getFirstMatch(/(?:msie |rv:)(\d+(\.\d+)?)/i)}}else if(chromeos){result={name:"Chrome",chromeos:t,chromeBook:t,chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}}else if(/chrome.+? edge/i.test(ua)){result={name:"Microsoft Edge",msedge:t,version:edgeVersion}}else if(/vivaldi/i.test(ua)){result={name:"Vivaldi",vivaldi:t,version:getFirstMatch(/vivaldi\/(\d+(\.\d+)?)/i)||versionIdentifier}}else if(sailfish){result={name:"Sailfish",sailfish:t,version:getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}}else if(/seamonkey\//i.test(ua)){result={name:"SeaMonkey",seamonkey:t,version:getFirstMatch(/seamonkey\/(\d+(\.\d+)?)/i)}}else if(/firefox|iceweasel|fxios/i.test(ua)){result={name:"Firefox",firefox:t,version:getFirstMatch(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)};if(/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(ua)){result.firefoxos=t}}else if(silk){result={name:"Amazon Silk",silk:t,version:getFirstMatch(/silk\/(\d+(\.\d+)?)/i)}}else if(/phantom/i.test(ua)){result={name:"PhantomJS",phantom:t,version:getFirstMatch(/phantomjs\/(\d+(\.\d+)?)/i)}}else if(/slimerjs/i.test(ua)){result={name:"SlimerJS",slimer:t,version:getFirstMatch(/slimerjs\/(\d+(\.\d+)?)/i)}}else if(/blackberry|\bbb\d+/i.test(ua)||/rim\stablet/i.test(ua)){
result={name:"BlackBerry",blackberry:t,version:versionIdentifier||getFirstMatch(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}}else if(webos){result={name:"WebOS",webos:t,version:versionIdentifier||getFirstMatch(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)};/touchpad\//i.test(ua)&&(result.touchpad=t)}else if(/bada/i.test(ua)){result={name:"Bada",bada:t,version:getFirstMatch(/dolfin\/(\d+(\.\d+)?)/i)}}else if(tizen){result={name:"Tizen",tizen:t,version:getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||versionIdentifier}}else if(/qupzilla/i.test(ua)){result={name:"QupZilla",qupzilla:t,version:getFirstMatch(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||versionIdentifier}}else if(/chromium/i.test(ua)){result={name:"Chromium",chromium:t,version:getFirstMatch(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||versionIdentifier}}else if(/chrome|crios|crmo/i.test(ua)){result={name:"Chrome",chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}}else if(android){result={name:"Android",version:versionIdentifier}}else if(/safari|applewebkit/i.test(ua)){result={name:"Safari",safari:t};if(versionIdentifier){result.version=versionIdentifier}}else if(iosdevice){result={name:iosdevice=="iphone"?"iPhone":iosdevice=="ipad"?"iPad":"iPod"};if(versionIdentifier){result.version=versionIdentifier}}else if(/googlebot/i.test(ua)){result={name:"Googlebot",googlebot:t,version:getFirstMatch(/googlebot\/(\d+(\.\d+))/i)||versionIdentifier}}else{result={name:getFirstMatch(/^(.*)\/(.*) /),version:getSecondMatch(/^(.*)\/(.*) /)}}if(!result.msedge&&/(apple)?webkit/i.test(ua)){if(/(apple)?webkit\/537\.36/i.test(ua)){result.name=result.name||"Blink";result.blink=t}else{result.name=result.name||"Webkit";result.webkit=t}if(!result.version&&versionIdentifier){result.version=versionIdentifier}}else if(!result.opera&&/gecko\//i.test(ua)){result.name=result.name||"Gecko";result.gecko=t;result.version=result.version||getFirstMatch(/gecko\/(\d+(\.\d+)?)/i)}if(!result.windowsphone&&!result.msedge&&(android||result.silk)){result.android=t}else if(!result.windowsphone&&!result.msedge&&iosdevice){result[iosdevice]=t;result.ios=t}else if(mac){result.mac=t}else if(xbox){result.xbox=t}else if(windows){result.windows=t}else if(linux){result.linux=t}var osVersion="";if(result.windowsphone){osVersion=getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i)}else if(iosdevice){osVersion=getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i);osVersion=osVersion.replace(/[_\s]/g,".")}else if(android){osVersion=getFirstMatch(/android[ \/-](\d+(\.\d+)*)/i)}else if(result.webos){osVersion=getFirstMatch(/(?:web|hpw)os\/(\d+(\.\d+)*)/i)}else if(result.blackberry){osVersion=getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i)}else if(result.bada){osVersion=getFirstMatch(/bada\/(\d+(\.\d+)*)/i)}else if(result.tizen){osVersion=getFirstMatch(/tizen[\/\s](\d+(\.\d+)*)/i)}if(osVersion){result.osversion=osVersion}var osMajorVersion=osVersion.split(".")[0];if(tablet||nexusTablet||iosdevice=="ipad"||android&&(osMajorVersion==3||osMajorVersion>=4&&!mobile)||result.silk){result.tablet=t}else if(mobile||iosdevice=="iphone"||iosdevice=="ipod"||android||nexusMobile||result.blackberry||result.webos||result.bada){result.mobile=t}if(result.msedge||result.msie&&result.version>=10||result.yandexbrowser&&result.version>=15||result.vivaldi&&result.version>=1||result.chrome&&result.version>=20||result.samsungBrowser&&result.version>=4||result.firefox&&result.version>=20||result.safari&&result.version>=6||result.opera&&result.version>=10||result.ios&&result.osversion&&result.osversion.split(".")[0]>=6||result.blackberry&&result.version>=10.1||result.chromium&&result.version>=20){result.a=t}else if(result.msie&&result.version<10||result.chrome&&result.version<20||result.firefox&&result.version<20||result.safari&&result.version<6||result.opera&&result.version<10||result.ios&&result.osversion&&result.osversion.split(".")[0]<6||result.chromium&&result.version<20){result.c=t}else result.x=t;return result}var bowser=detect(typeof navigator!=="undefined"?navigator.userAgent||"":"");bowser.test=function(browserList){for(var i=0;i<browserList.length;++i){var browserItem=browserList[i];if(typeof browserItem==="string"){if(browserItem in bowser){return true}}}return false};function getVersionPrecision(version){return version.split(".").length}function map(arr,iterator){var result=[],i;if(Array.prototype.map){return Array.prototype.map.call(arr,iterator)}for(i=0;i<arr.length;i++){result.push(iterator(arr[i]))}return result}function compareVersions(versions){var precision=Math.max(getVersionPrecision(versions[0]),getVersionPrecision(versions[1]));var chunks=map(versions,function(version){var delta=precision-getVersionPrecision(version);version=version+new Array(delta+1).join(".0");return map(version.split("."),function(chunk){return new Array(20-chunk.length).join("0")+chunk}).reverse()});while(--precision>=0){if(chunks[0][precision]>chunks[1][precision]){return 1}else if(chunks[0][precision]===chunks[1][precision]){if(precision===0){return 0}}else{return-1}}}function isUnsupportedBrowser(minVersions,strictMode,ua){var _bowser=bowser;if(typeof strictMode==="string"){ua=strictMode;strictMode=void 0}if(strictMode===void 0){strictMode=false}if(ua){_bowser=detect(ua)}var version=""+_bowser.version;for(var browser in minVersions){if(minVersions.hasOwnProperty(browser)){if(_bowser[browser]){if(typeof minVersions[browser]!=="string"){throw new Error("Browser version in the minVersion map should be a string: "+browser+": "+String(minVersions))}return compareVersions([version,minVersions[browser]])<0}}}return strictMode}function check(minVersions,strictMode,ua){return!isUnsupportedBrowser(minVersions,strictMode,ua)}bowser.isUnsupportedBrowser=isUnsupportedBrowser;bowser.compareVersions=compareVersions;bowser.check=check;bowser._detect=detect;return bowser})},function(module,exports,__webpack_require__){"use strict";var Commons=__webpack_require__(7);var LISTENERS=Commons.LISTENERS;var ATTRIBUTE=Commons.ATTRIBUTE;var newNode=Commons.newNode;function getAttributeListener(eventTarget,type){var node=eventTarget[LISTENERS][type];while(node!=null){if(node.kind===ATTRIBUTE){return node.listener}node=node.next}return null}function setAttributeListener(eventTarget,type,listener){if(typeof listener!=="function"&&typeof listener!=="object"){listener=null}var prev=null;var node=eventTarget[LISTENERS][type];while(node!=null){if(node.kind===ATTRIBUTE){if(prev==null){eventTarget[LISTENERS][type]=node.next}else{prev.next=node.next}}else{prev=node}node=node.next}if(listener!=null){if(prev==null){eventTarget[LISTENERS][type]=newNode(listener,ATTRIBUTE)}else{prev.next=newNode(listener,ATTRIBUTE)}}}exports.defineCustomEventTarget=function(EventTargetBase,types){function EventTarget(){EventTargetBase.call(this)}var descripter={constructor:{value:EventTarget,configurable:true,writable:true}};types.forEach(function(type){descripter["on"+type]={get:function(){return getAttributeListener(this,type)},set:function(listener){setAttributeListener(this,type,listener)},configurable:true,enumerable:true}});EventTarget.prototype=Object.create(EventTargetBase.prototype,descripter);return EventTarget}},function(module,exports,__webpack_require__){"use strict";var createUniqueKey=__webpack_require__(7).createUniqueKey;var STOP_IMMEDIATE_PROPAGATION_FLAG=createUniqueKey("stop_immediate_propagation_flag");var CANCELED_FLAG=createUniqueKey("canceled_flag");var ORIGINAL_EVENT=createUniqueKey("original_event");var wrapperPrototypeDefinition=Object.freeze({stopPropagation:Object.freeze({value:function stopPropagation(){var e=this[ORIGINAL_EVENT];if(typeof e.stopPropagation==="function"){e.stopPropagation()}},writable:true,configurable:true}),stopImmediatePropagation:Object.freeze({value:function stopImmediatePropagation(){this[STOP_IMMEDIATE_PROPAGATION_FLAG]=true;var e=this[ORIGINAL_EVENT];if(typeof e.stopImmediatePropagation==="function"){e.stopImmediatePropagation()}},writable:true,configurable:true}),preventDefault:Object.freeze({value:function preventDefault(){if(this.cancelable===true){this[CANCELED_FLAG]=true}var e=this[ORIGINAL_EVENT];if(typeof e.preventDefault==="function"){e.preventDefault()}},writable:true,configurable:true}),defaultPrevented:Object.freeze({get:function defaultPrevented(){return this[CANCELED_FLAG]},enumerable:true,configurable:true})});exports.STOP_IMMEDIATE_PROPAGATION_FLAG=STOP_IMMEDIATE_PROPAGATION_FLAG;exports.createEventWrapper=function createEventWrapper(event,eventTarget){var timeStamp=typeof event.timeStamp==="number"?event.timeStamp:Date.now();var propertyDefinition={type:{value:event.type,enumerable:true},target:{value:eventTarget,enumerable:true},currentTarget:{value:eventTarget,enumerable:true},eventPhase:{value:2,enumerable:true},bubbles:{value:Boolean(event.bubbles),enumerable:true},cancelable:{value:Boolean(event.cancelable),enumerable:true},timeStamp:{value:timeStamp,enumerable:true},isTrusted:{value:false,enumerable:true}};propertyDefinition[STOP_IMMEDIATE_PROPAGATION_FLAG]={value:false,writable:true};propertyDefinition[CANCELED_FLAG]={value:false,writable:true};propertyDefinition[ORIGINAL_EVENT]={value:event};if(typeof event.detail!=="undefined"){propertyDefinition.detail={value:event.detail,enumerable:true}}return Object.create(Object.create(event,wrapperPrototypeDefinition),propertyDefinition)}},function(module,exports){module.exports=function(){throw new Error("define cannot be used indirect")}},function(module,exports){module.exports={name:"web-push-sdk",version:"0.0.1",description:"",main:"src/index.js",scripts:{start:"./node_modules/.bin/webpack --color --watch","build-sdk":"./node_modules/.bin/webpack --color && ./node_modules/.bin/uglifyjs ./dist/ua-sdk.js -o ./dist/ua-sdk.min.js --source-map ./dist/ua-sdk.min.js.map  --comments /UA-Web-Push:/","build-dist-tests":"`npm bin`/browserify src/tests/dist-entry.js > src/tests/build/dist-index.js && cp -r src/tests/build dist/test/",build:"npm run build-sdk && npm run build-dist-tests","deploy-prod":"npm run build && aws s3 sync dist s3://web-push-beta-sdk/web-push-beta/ && aws s3 sync build/_demo-prod s3://web-push-beta-sdk/_demo-prod/ && npm run invalidate","deploy-stag":"npm run build && aws s3 sync dist s3://web-push-beta-sdk/web-push-beta-stag/ && aws s3 sync build/_demo-stag s3://web-push-beta-sdk/_demo-stag/ && npm run invalidate",invalidate:"aws cloudfront create-invalidation --distribution-id E9OCCW413GC7N --paths '/_demo-prod/*' '/_demo-stag/*' '/web-push-beta/*' '/web-push-beta-stag/*'",server:"./node_modules/.bin/webpack-dev-server",test:"./src/tests/runner.sh","test-dist":"npm run build >/dev/null && ./src/tests/dist-runner.sh","test-dist-sauce":"npm run build && `npm bin`/easy-sauce"},author:"Urban Airship",dependencies:{bowser:"^1.5.0","event-target-shim":"^1.1.1"},browser:{fs:false},babel:{"extends":"./.babelrc"},browserify:{transform:[["babelify",{plugins:["transform-es2015-arrow-functions","transform-es2015-block-scoping","transform-es2015-classes","transform-es2015-destructuring","transform-es2015-for-of","transform-es2015-parameters","transform-es2015-shorthand-properties","transform-es2015-spread","transform-es2015-template-literals","transform-object-assign"]}]]},easySauce:{port:"8080",testPath:"/dist/test/index.html",name:"Web Push SDK: distribution tests",platforms:[["Windows 10","chrome","latest"],["Windows 10","MicrosoftEdge","14.14393"],["Windows 10","internet explorer","11.103"],["Windows 8","internet explorer","10.0"],["Windows 7","chrome","45.0"],["Linux","firefox","latest"],["Linux","chrome","latest"],["macOS 10.12","safari","10.0"],["OS X 10.11","safari","10.0"],["OS X 10.11","safari","9.0"]],service:"sauce-connect",serviceOptions:{verbose:true},framework:"custom"},devDependencies:{"babel-cli":"^6.3.17","babel-core":"^6.24.0","babel-loader":"^6.4.1","babel-plugin-transform-es2015-arrow-functions":"^6.22.0","babel-plugin-transform-es2015-block-scoping":"^6.23.0","babel-plugin-transform-es2015-classes":"^6.23.0","babel-plugin-transform-es2015-destructuring":"^6.23.0","babel-plugin-transform-es2015-for-of":"^6.23.0","babel-plugin-transform-es2015-parameters":"^6.23.0","babel-plugin-transform-es2015-shorthand-properties":"^6.22.0","babel-plugin-transform-es2015-spread":"^6.22.0","babel-plugin-transform-es2015-template-literals":"^6.22.0","babel-plugin-transform-object-assign":"^6.22.0",babelify:"^7.3.0",browserify:"^14.1.0",consolidate:"^0.14.5","easy-sauce":"^0.4.1",ejs:"^2.5.5","extract-text-webpack-plugin":"^2.0.0-rc.2","git-repo-info":"^1.4.0",handlebars:"^4.0.6","json-loader":"^0.5.4",proxyquireify:"^3.2.1",smokestack:"^3.4.1","tap-closer":"^1.0.0","tap-summary":"^3.0.1",tape:"^4.6.3","template-html-loader":"^1.0.0",typescript:"^2.0.8","uglify-js-harmony":"^2.6.2",webpack:"^2.2.1","webpack-dev-server":"^1.16.2"}}},function(module,exports,__webpack_require__){var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EventTarget=__webpack_require__(6);var Channel=__webpack_require__(8);var canRegister=__webpack_require__(15);var config=__webpack_require__(0);var configure=__webpack_require__(4);var debug=__webpack_require__(3);var isAfter=__webpack_require__(16);var isSupported=__webpack_require__(13);var registrationBase=__webpack_require__(5);var registrationData=__webpack_require__(9);var reports=__webpack_require__(11);var request=__webpack_require__(1);var secureBridge=__webpack_require__(14);var storage=__webpack_require__(2);var subscribe=__webpack_require__(10);var setupWorker=__webpack_require__(17);var db=__webpack_require__(12);module.exports=setup;module.exports.isSupported=isSupported();module.exports.secureBridge=secureBridge.setupBridge;module.exports.worker=setupWorker;var EVENT_TYPES=["channel","push","tags"];var UaSDK=function(_EventTarget){_inherits(UaSDK,_EventTarget);function UaSDK(){_classCallCheck(this,UaSDK);var _this=_possibleConstructorReturn(this,(UaSDK.__proto__||Object.getPrototypeOf(UaSDK)).call(this));_this._workerRegistration=navigator.serviceWorker.register(config.workerUrl);_this._workerRegistration.catch(function(error){return debug(error)});_this.addEventListener("channel",heartbeat);_this.addEventListener("channel",reportSession);_this.addEventListener("channel",checkPermission);_this.isSupported=isSupported();_this.canRegister=canRegister();_this._setChannel(channelFromStorage());window.addEventListener("storage",secureBridge.onStorage(function(data){return _this._set(data)}));_this._permission=null;if(config.secureIframeUrl){_this.setupIframe=secureBridge.setupIframe;_this.setupIframe(config.secureIframeUrl)}navigator.serviceWorker.addEventListener("message",function(message){debug("Push event from worker",message);if(message.data.type==="push"){_this.dispatchEvent({type:"push",push:message.data.push})}});_this._={db:db,storage:storage,request:request,registrationBase:registrationBase,Channel:Channel};function channelFromStorage(){var channel=storage.getJSON("channel");if(channel){return new Channel(channel)}return null}function heartbeat(ev){var _this2=this;var _isAfter=isAfter("heartbeat",24),after=_isAfter.after,store=_isAfter.store;if(after){debug("SENDING heartbeat");store();if(this.channel.optedIn){this.register().catch(function(e){return _this2.channel._update()})}else{this.channel._update()}}this.removeEventListener("channel",heartbeat)}function reportSession(ev){var _isAfter2=isAfter("activity",.5),after=_isAfter2.after,store=_isAfter2.store;store();if(after){reports.session(this.channel)}this.removeEventListener("channel",heartbeat)}function checkPermission(ev){this._checkPermission();this.removeEventListener("channel",checkPermission)}return _this}_createClass(UaSDK,[{key:"register",value:function register(){var sdk=this;return sdk._workerRegistration.then(subscribe).then(function(subscription){var registration=registrationData(subscription);if(sdk.channel){return request(sdk.channel.path,{method:"put",body:registration})}return request(config.paths.cra,{method:"post",body:registration})}).then(function(response){return response.json()}).then(function(body){debug("CRA RESPONSE",body);var channel=new Channel(body);var _isAfter3=isAfter("heartbeat",24),store=_isAfter3.store;store();sdk._setChannel(channel);return Promise.resolve(channel)})}},{key:"_checkPermission",value:function _checkPermission(){if(this.permission&&this.channel&&this.permission!=="granted"&&this.channel.optedIn){this.channel.optOut()}}},{key:"_set",value:function _set(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(data.channel){this._setChannel(new Channel(data.channel))}if(data.tags){if(this.channel){this.channel.tags._load(data.tags);this.channel.tags._store()}}if(data.permission){this._permission=data.permission;this._checkPermission()}}},{key:"_setChannel",value:function _setChannel(channel){var _this3=this;this.channel=channel;if(channel){channel.addEventListener("channel",function(ev){_this3.dispatchEvent({type:"channel",channel:ev.channel})});channel.tags.addEventListener("tags",function(ev){_this3.dispatchEvent({type:"tags",tags:ev.tags})});channel._store();db.set("channel",channel.toJSON())}}},{key:"permission",get:function(){return this._permission||window.isSecureContext&&window.Notification.permission}}]);return UaSDK}(EventTarget.apply(undefined,EVENT_TYPES));function setup(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};configure(opts);if(!isSupported()){return{register:noop,isSupported:false,canRegister:false,channel:null,onchannel:null,ontags:null,onpush:null}}return new UaSDK}function noop(){}}])});
//# sourceMappingURL=./dist/ua-sdk.min.js.mapoA6      YyYy>Yy   B    :https://d2ob6tofij0erf.cloudfront.net/web-push-beta/ua-sdk.min.js necko:classified 1 strongly-framed 1 security-info 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 request-method GET response-head HTTP/2.0 200 OK
Content-Type: application/javascript
Content-Length: 50952
Date: Fri, 26 May 2017 12:08:23 GMT
Last-Modified: Tue, 21 Mar 2017 23:42:13 GMT
Etag: "0a899a611f7f348bc13fe92eb9f22a8b"
Accept-Ranges: bytes
Server: AmazonS3
Age: 5450
X-Cache: Hit from cloudfront
Via: 1.1 e3228acb4b07b21eba94234a10678aed.cloudfront.net (CloudFront)
X-Amz-Cf-Id: VIbgms1oQd-EFbPoD50197bEaHbqq8p1qT2ZTZSoObGLXOx2WJ2VLA==
X-Firefox-Spdy: h2
 original-response-headers Content-Type: application/javascript
Content-Length: 50952
Date: Fri, 26 May 2017 12:08:23 GMT
Last-Modified: Tue, 21 Mar 2017 23:42:13 GMT
Etag: "0a899a611f7f348bc13fe92eb9f22a8b"
Accept-Ranges: bytes
Server: AmazonS3
Age: 5450
X-Cache: Hit from cloudfront
Via: 1.1 e3228acb4b07b21eba94234a10678aed.cloudfront.net (CloudFront)
X-Amz-Cf-Id: VIbgms1oQd-EFbPoD50197bEaHbqq8p1qT2ZTZSoObGLXOx2WJ2VLA==
X-Firefox-Spdy: h2
 uncompressed-len 0 net-response-time-onstart 1017 net-response-time-onstop 1018   